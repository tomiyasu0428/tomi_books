
# フロントエンドリファクタリング提案書

## 1. はじめに

現在のフロントエンドコード（特に `page.tsx`）は、初期開発段階として機能していますが、今後の拡張性や保守性を考慮すると、いくつかの改善点が見られます。このドキュメントでは、コードの品質を向上させるための具体的なリファクタリング方針を提案します。

## 2. 現状の課題

-   **関心の分離:** `page.tsx` にUIの構造、モックデータ、スタイリングが混在しており、見通しが悪くなっています。
-   **再利用性の欠如:** レビューカードやセクションタイトルなど、繰り返し利用される可能性のあるUIがコンポーネント化されていません。
-   **データフローの不透明性:** Sanityからのデータ取得ロジックがコンポーネントに直接埋め込まれる可能性があり、データフローの管理が煩雑になる恐れがあります。
-   **型の不整合:** Sanityスキーマで定義された型と、フロントエンドで利用されるデータの型が同期されておらず、手動での管理が必要です。

## 3. リファクタリング方針

### 3.1. コンポーネントの分割

`page.tsx` を以下のコンポーネントに分割します。

-   `src/components/Hero.tsx`: 既存のヒーローセクション
-   `src/components/ReviewCard.tsx`: 最新レビューセクションで使われる個別のレビューカード
-   `src/components/ReviewSection.tsx`: 最新レビューセクション全体
-   `src/components/CategoryCard.tsx`: カテゴリーセクションで使われる個別のカテゴリーカード
-   `src/components/CategorySection.tsx`: カテゴリーセクション全体
-   `src/components/CommunitySection.tsx`: コミュニティセクション

**期待される効果:**
-   各コンポーネントの責務が明確になり、コードの見通しが向上します。
-   UIパーツの再利用が容易になります。

### 3.2. データ取得ロジックの抽象化

`src/lib/sanity.ts` に、各ページやコンポーネントで必要とされるデータを取得するための関数を定義します。

**例:**

```typescript
// src/lib/sanity.ts

// ... 既存のclientとクエリ定義 ...

export async function getLatestReviews() {
  return client.fetch(REVIEWS_QUERY);
}

export async function getReviewBySlug(slug: string) {
  return client.fetch(REVIEW_QUERY, { slug });
}

// 他のデータ取得関数...
```

**期待される効果:**
-   データ取得のロジックを一元管理でき、コンポーネントは表示に専念できます。
-   クエリの再利用性が高まります。

### 3.3. 型定義の共通化

Sanityのスキーマ定義からTypeScriptの型を自動生成する仕組みを導入します。`sanity-codegen` や `sanity-ts` といったツールを利用します。

**手順:**
1.  型生成ツールを導入
2.  `package.json` に型生成用のスクリプトを追加
3.  生成された型をフロントエンドのコードでインポートして利用する

**例:**
モックデータの代わりに、生成された `Review` 型を利用します。

```typescript
import type { Review } from '@/sanity-types'; // 自動生成された型

const reviews: Review[] = await getLatestReviews();
```

**期待される効果:**
-   バックエンドとフロントエンドの型の一貫性が保証され、型安全性が向上します。
-   手動での型定義が不要になり、開発効率が向上します。

### 3.4. UIコンポーネントの整備

汎用的なUIコンポーネントを作成し、`src/components/ui` ディレクトリに配置します。

-   `src/components/ui/Card.tsx`
-   `src/components/ui/Button.tsx`
-   `src/components/ui/SectionTitle.tsx`

**期待される効果:**
-   UIの一貫性を保ちやすくなります。
-   デザインの変更が容易になります。

### 3.5. 環境変数の管理

`website/.env.local` ファイルでSanityのプロジェクトIDとデータセットを管理します。

```
NEXT_PUBLIC_SANITY_PROJECT_ID="o9qqv90y"
NEXT_PUBLIC_SANITY_DATASET="production"
```

`src/lib/sanity.ts` でこれを参照します。

```typescript
// src/lib/sanity.ts
export const client = createClient({
  projectId: process.env.NEXT_PUBLIC_SANITY_PROJECT_ID,
  dataset: process.env.NEXT_PUBLIC_SANITY_DATASET,
  // ...
});
```

**期待される効果:**
-   設定値を一元管理でき、環境ごとの切り替えが容易になります。
-   機密情報がコードにハードコーディングされるのを防ぎます。

## 4. 結論

上記のリファクタリングを実施することで、プロジェクト全体のコード品質が向上し、今後の開発をよりスムーズに進めることができます。まずはドキュメントベースでの提案とし、合意が取れ次第、実際のコード修正に着手します。
